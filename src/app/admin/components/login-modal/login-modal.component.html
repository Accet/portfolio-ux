<div class="modal-header">
	<h4 class="modal-title">Log in</h4>
	<button type="button" class="close" aria-label="Close" (click)="closeModal()">
		<span aria-hidden="true">&times;</span>
	</button>
</div>

<form [formGroup]="loginForm">
	<div class="modal-body">
		<div class="row form-group">
			<div class="col-12">
				<mat-form-field class="form-input">
					<input
						matInput
						required
						name="email"
						type="email"
						[placeholder]="'Email'"
						id="login-email"
						[formControlName]="'email'"
					/>
				</mat-form-field>
				<div
					*ngIf="loginForm.controls['email'].touched && loginForm.controls['email'].hasError('required')"
					class="text-danger form-error"
				>
					Email is required
				</div>
				<div
					*ngIf="loginForm.controls['email'].touched && loginForm.controls['email'].hasError('validateEmail')"
					class="text-danger form-error"
				>
					Invalid email
				</div>
				<div
					*ngIf="loginForm.controls['email'].touched && loginForm.controls['email'].hasError('disabled')"
					class="text-danger form-error"
				>
					User disabled. Contact me for details.
				</div>
				<div
					*ngIf="loginForm.controls['email'].touched && loginForm.controls['email'].hasError('notFound')"
					class="text-danger form-error"
				>
					User not found. Check your credentials, please.
				</div>
			</div>
		</div>

		<div class="row form-group">
			<div class="col-12">
				<mat-form-field
					class="form-input"
					#popOver="ngbPopover"
					triggers="manual"
					placement="top"
					[ngbPopover]="'Caps Lock is On'"
				>
					<div class="d-flex" appCapsDetector (state)="handleCapsLockState($event)">
						<input
							matInput
							name="password"
							(focus)="handleFocusOnPassword(true)"
							(blur)="handleFocusOnPassword(false)"
							formControlName="password"
							required
							id="login-password"
							[type]="visiblePassword ? 'text' : 'password'"
							placeholder="Password"
						/>
						<a
							*ngIf="loginForm.controls['password'].value"
							mat-icon-button
							[tabIndex]="0"
							(click)="togglePasswordVisibility($event)"
							class="btn-clear"
						>
							<mat-icon class="btn-clear-icon" [svgIcon]="visiblePassword ? 'hide' : 'show'"></mat-icon>
						</a>
					</div>
				</mat-form-field>
				<div
					*ngIf="loginForm.controls['password'].touched && loginForm.controls['password'].hasError('required')"
					class="text-danger form-error"
				>
					Password is required
				</div>
				<div
					*ngIf="loginForm.controls['password'].touched && loginForm.controls['password'].hasError('invalid')"
					class="text-danger form-error"
				>
					Oops! Wrong password. Try again, please.
				</div>
			</div>
		</div>
		<div class="row align-items-stretch justify-content-start">
			<a class="px-3" (click)="showForgot($event)">
				Forgot your password?
			</a>
		</div>
	</div>
	<div class="modal-footer">
		<button mat-stroked-button color="warn" class="btn px-3" (click)="closeModal($event)">
			Cancel
		</button>
		<button (click)="handleLogin($event)" #btnRef mat-flat-button color="primary" class="btn px-3">
			Login
		</button>
	</div>
</form>
